<!-- ia-translate: true -->
# Expressão de rastreamento causou recriação da estrutura DOM.

A expressão track de identidade especificada no loop `@for` causou a recriação do DOM correspondente a _todos_ os itens. Esta é uma operação muito cara que geralmente ocorre ao trabalhar com estruturas de dados imutáveis. Por exemplo:

```typescript
@Component({
  template: `
    <button (click)="toggleAllDone()">All done!</button>
    <ul>
    @for (todo of todos; track todo) {
      <li>{{todo.task}}</li>
    }
    </ul>
  `,
})
export class App {
  todos = [
    { id: 0, task: 'understand trackBy', done: false },
    { id: 1, task: 'use proper tracking expression', done: false },
  ];

  toggleAllDone() {
    this.todos = this.todos.map(todo => ({ ...todo, done: true }));
  }
}
```

No exemplo fornecido, a lista inteira com todas as views (nós DOM, directives Angular, components, queries, etc.) são recriadas (!) após alternar o status "done" dos itens. Aqui, uma atualização de binding relativamente barata para a propriedade `done` seria suficiente.

Além de ter uma alta penalidade de desempenho, recriar a árvore DOM resulta em perda de estado nos elementos DOM (por exemplo: foco, seleção de texto, sites carregados em um iframe, etc.).

## Corrigindo o erro

Altere a expressão de rastreamento para que ela identifique exclusivamente um item em uma coleção, independentemente de sua identidade de objeto. No exemplo discutido, a expressão track correta usaria a propriedade `id` única (`item.id`):

```typescript
@Component({
  template: `
    <button (click)="toggleAllDone()">All done!</button>
    <ul>
    @for (todo of todos; track todo.id) {
      <li>{{todo.task}}</li>
    }
    </ul>
  `,
})
export class App {
  todos = [
    { id: 0, task: 'understand trackBy', done: false },
    { id: 1, task: 'use proper tracking expression', done: false },
  ];

  toggleAllDone() {
    this.todos = this.todos.map(todo => ({ ...todo, done: true }));
  }
}
```
